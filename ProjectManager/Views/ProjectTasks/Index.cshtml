@model IEnumerable<ProjectManager.Models.ProjectTask>

@{ ViewData["Title"] = "Zadania"; }

<h1>Lista Zadań</h1>

<p><a asp-action="Create" class="btn btn-primary">Dodaj zadanie</a></p>

<table class="table table-hover align-middle">
    <thead>
    <tr>
        <th>Temat</th>
        <th>Typ</th>
        <th>Opis</th>
        <th>Postęp</th>
        <th>Projekt</th>
        <th>Przypisany do</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var item in Model) {
        <tr>
            <td>@item.Topic</td>
            <td>
                @if(item.Category?.Name == "Bug") { <span class="badge bg-danger">BUG</span> }
                else if(item.Category?.Name == "Feature") { <span class="badge bg-primary">Feature</span> }
                else { <span class="badge bg-secondary">@item.Category?.Name</span> }
            </td>
            <td>@item.Description</td>
            <td style="min-width: 150px;">
                @{
                    // Logika dobierania koloru paska
                    string progressColor = "bg-danger"; // RED LOW
        
                    if (item.Progress == 100) {
                        progressColor = "bg-success"; // GREEN FINISH
                    } 
                    else if (item.Progress >= 75) {
                        progressColor = "bg-info";    // CYAN ENDING
                    } 
                    else if (item.Progress >= 40) {
                        progressColor = "bg-primary"; // BLUE IN PROGRESS
                    } 
                    else if (item.Progress >= 15) {
                        progressColor = "bg-warning text-dark"; // YELLOW STARTING
                    }
                }

                <div class="progress" style="height: 22px; background-color: #e9ecef; border-radius: 10px; box-shadow: inset 0 1px 2px rgba(0,0,0,.1);">
                    <div class="progress-bar progress-bar-striped progress-bar-animated @progressColor" 
                         role="progressbar" 
                         style="width: @item.Progress%; font-weight: bold; font-size: 0.85rem;" 
                         aria-valuenow="@item.Progress" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                         @item.Progress%
                    </div>
                </div>
            </td>
            <td>@item.Project?.Title</td>
            <td>
                @if(item.AssignedUser != null)
                {
                    <span class="badge bg-info text-dark">@item.AssignedUser.Email</span>
                }
                else
                {
                    <span class="text-muted">Nieprzypisane</span>
                }
            </td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning fw-bold shadow-sm">
                    <i class="bi bi-pencil-square"></i> Edytuj
                </a>
            </td>
        </tr>
    }
    </tbody>
</table>